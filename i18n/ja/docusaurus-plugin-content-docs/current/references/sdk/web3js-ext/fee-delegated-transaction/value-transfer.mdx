# 価値移転

TxTypeValueTransferは、ユーザーがKAIAを送信したいときに使用される。

- kaiaは、各トランザクションタイプが単一の目的を果たすように複数のトランザクションタイプを提供しているため、TxTypeValueTransferは、KAIAを外部所有口座（EOA）に送信するように制限されている。

<CH.Spotlight>
<CH.Code>

```js TxTypeFeeDelegatedValueTransfer.js
const { Web3, TxType, toPeb } = require("@kaiachain/web3js-ext");

const senderAddr = "0xa2a8854b1802d8cd5de631e690817c253d6a9153";
const senderPriv = "0x0e4ca6d38096ad99324de0dde108587e5d7c600165ae4cd6c2462c597458c2b8";
const feePayerPriv = "0x9435261ed483b6efa3886d6ad9f64c12078a0e28d8d80715c773e16fc000cff4";
const recieverAddr = "0xc40b6909eb7085590e1c26cb3becc25368e249e9";

const provider = new Web3.providers.HttpProvider("https://public-en-kairos.node.kaia.io");
const web3 = new Web3(provider);
const senderAccount = web3.eth.accounts.privateKeyToAccount(senderPriv);
const feePayerAccount = web3.eth.accounts.privateKeyToAccount(feePayerPriv);

async function main() {
  const tx = {
    type: TxType.FeeDelegatedValueTransfer,
    from: senderAddr,
    to: recieverAddr,
    value: toPeb("0.01"),
  };

  // Sign transaction by sender
  const signResult1 = await senderAccount.signTransaction(tx);
  console.log("senderTxHashRLP", signResult1.rawTransaction);

  // Sign and send transaction by fee payer
  const signResult2 = await feePayerAccount.signTransactionAsFeePayer(signResult1.rawTransaction);
  console.log("signedTx", signResult2.transactionHash);

  const receipt = await web3.eth.sendSignedTransaction(signResult2.rawTransaction);
  console.log("receipt", receipt);
}

main();
```

---

```zsh output
❯ node TxTypeFeeDelegatedValueTransfer.js
senderTxHashRLP 0x09f8878203b6850ba43b740082cd1494c40b6909eb7085590e1c26cb3becc25368e249e9872386f26fc1000094a2a8854b1802d8cd5de631e690817c253d6a9153f847f8458207f5a0119485c48b7587a7ba6358f759c0a31e7de94fea77ba28089e20135156af7d94a07c497057653e76b9646bf5cc2024aa6d58cba23d4b2fec932e61e288cb2513f9
signedTx 0xded94a15a62b6d24ac4d0a317f0ed37873d4105b0ff7500e577f6d282fdc4bae
receipt {
  blockHash: '0x442774c57650ef18338bea13ad069428acf8a6c8da5e7eb104dd1d961972400a',
  blockNumber: 148744776n,
  cumulativeGasUsed: 177286n,
  effectiveGasPrice: 25000000000n,
  from: '0xa2a8854b1802d8cd5de631e690817c253d6a9153',
  gasUsed: 31000n,
  logs: [],
  logsBloom: '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  status: 1n,
  to: '0xc40b6909eb7085590e1c26cb3becc25368e249e9',
  transactionHash: '0xded94a15a62b6d24ac4d0a317f0ed37873d4105b0ff7500e577f6d282fdc4bae',
  transactionIndex: 1n,
  type: 0n
}

```

</CH.Code>

---

web3にkaiaの機能を追加するために、**web3**と **@kaiachain/web3js-ext**パッケージをインポートする。

```js TxTypeFeeDelegatedValueTransfer.js focus=1

```

---

**sender**、**fee payer**のアドレスと秘密鍵を定義する。

```js TxTypeFeeDelegatedValueTransfer.js focus=3:6

```

---

指定された**kairos** testnet URLでプロバイダを設定します。 web3のプロバイダーは、ブロックチェーンのデータにアクセスするための読み取り専用の抽象化されたものです。

```js TxTypeFeeDelegatedValueTransfer.js focus=8:9

```

---

また、プロバイダのURLを**kairos**から**quicknode**に変更することができます。

```js TxTypeFeeDelegatedValueTransfer.js focus=8
const { Web3, TxType, toPeb } = require("@kaiachain/web3js-ext");

const senderAddr = "0xa2a8854b1802d8cd5de631e690817c253d6a9153";
const senderPriv = "0x0e4ca6d38096ad99324de0dde108587e5d7c600165ae4cd6c2462c597458c2b8";
const feePayerPriv = "0x9435261ed483b6efa3886d6ad9f64c12078a0e28d8d80715c773e16fc000cff4";
const recieverAddr = "0xc40b6909eb7085590e1c26cb3becc25368e249e9";

const provider = new Web3.providers.HttpProvider("https://public-en-kairos.node.kaia.io");
const web3 = new Web3(provider);
const senderAccount = web3.eth.accounts.privateKeyToAccount(senderPriv);
const feePayerAccount = web3.eth.accounts.privateKeyToAccount(feePayerPriv);

async function main() {
  const tx = {
    type: TxType.FeeDelegatedValueTransfer,
    from: senderAddr,
    to: recieverAddr,
    value: toPeb("0.01"),
  };

  // Sign transaction by sender
  const signResult1 = await senderAccount.signTransaction(tx);
  console.log("senderTxHashRLP", signResult1.rawTransaction);

  // Sign and send transaction by fee payer
  const signResult2 = await feePayerAccount.signTransactionAsFeePayer(signResult1.rawTransaction);
  console.log("signedTx", signResult2.transactionHash);

  const receipt = await web3.eth.sendSignedTransaction(signResult2.rawTransaction);
  console.log("receipt", receipt);
}

main();
```

---

`web3.eth.account.privateKeyToAccount`を使用して、秘密鍵で**送信者のウォレット**を作成する。

```js TxTypeFeeDelegatedValueTransfer.js focus=10

```

---

`web3.eth.account.privateKeyToAccount`を使用して、秘密鍵で**料金支払者のウォレット**を作成する。

```js TxTypeFeeDelegatedValueTransfer.js focus=11

```

---

トランザクションオブジェクトを定義する。

```js TxTypeFeeDelegatedValueTransfer.js focus=14:20

```

---

typeを設定する：TxType.FeeDelegatedValueTransfer\`をセットする。

```js TxTypeFeeDelegatedValueTransfer.js focus=15

```

---

`value:toPeb("0.01")`を設定して転送する値を定義し、`toPeb`を使用してKlayをPebに変換する。

```js TxTypeFeeDelegatedValueTransfer.js focus=18

```

---

**from**や**to**などのパラメータを設定する。

```js TxTypeFeeDelegatedValueTransfer.js focus=16:17

```

---

`signTransaction`を使って**sender**アカウントでトランザクションに署名する。

<CH.Code>
```js TxTypeFeeDelegatedValueTransfer.js focus=21:23

````
---

```zsh output
❯ node TxTypeFeeDelegatedValueTransfer.js
senderTxHashRLP 0x11f88d8203b7850ba43b740082d1f694c40b6909eb7085590e1c26cb3becc25368e249e9872386f26fc1000094a2a8854b1802d8cd5de631e690817c253d6a9153851234567890f847f8458207f5a0fbd13725c0e913f564469d43e6e928514caca92ca5d5fcc18c493445d2bd3f00a065980c9c0ea0bcfa4324c23b21d45acaa8a64d1d47d45a6730774756be794e86
````

</CH.Code>

---

`signTransactionAsFeePayer`を使用して、**fee payer**アカウントでトランザクションに署名する。

<CH.Code>
```js TxTypeFeeDelegatedValueTransfer.js focus=25:27

````
---

```zsh output
❯ node TxTypeFeeDelegatedValueTransfer.js
signedTx 0xded94a15a62b6d24ac4d0a317f0ed37873d4105b0ff7500e577f6d282fdc4bae
````

</CH.Code>

---

トランザクションをブロックチェーンに送信する。 取引レシートを返します。

<CH.Code>
```js TxTypeFeeDelegatedValueTransfer.js focus=29:30

````
---

```zsh output
❯ node TxTypeFeeDelegatedValueTransfer.js
receipt {
  blockHash: '0x442774c57650ef18338bea13ad069428acf8a6c8da5e7eb104dd1d961972400a',
  blockNumber: 148744776n,
  cumulativeGasUsed: 177286n,
  effectiveGasPrice: 25000000000n,
  from: '0xa2a8854b1802d8cd5de631e690817c253d6a9153',
  gasUsed: 31000n,
  logs: [],
  logsBloom: '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  status: 1n,
  to: '0xc40b6909eb7085590e1c26cb3becc25368e249e9',
  transactionHash: '0xded94a15a62b6d24ac4d0a317f0ed37873d4105b0ff7500e577f6d282fdc4bae',
  transactionIndex: 1n,
  type: 0n
}
````

</CH.Code>
</CH.Spotlight>
